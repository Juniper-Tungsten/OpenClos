chassis {
    aggregated-devices {
        ethernet {
            device-count {{lagCount}};
        }
    }
}

interfaces {
    {% for memberInterface in memberInterfaces %}
    replace:
    {{memberInterface}} {
        ether-options {
            802.3ad {{lagName}};
        }
    }
    {% endfor %}
    {{lagName}} {
        esi {
            {{ethernetSegmentId}};
            all-active;
        }
        flexible-vlan-tagging;
        encapsulation flexible-ethernet-services;
        {% if networks and networks|length == 1 %}
        native-vlan-id {{networks[0][0]}};
        {% else %}
        delete:
        native-vlan-id;
        {% endif %}
        {% if networks and networks|length > 0 %}
        {% for network in networks %}unit {{network[0]}} {
            encapsulation vlan-bridge;
            vlan-id {{network[0]}};
        }
        {% endfor %}
        {% endif %}
        {% if deletedNetworks and deletedNetworks|length > 0 %}
        {% for deletedNetwork in deletedNetworks %}
        delete:
        unit {{deletedNetwork[0]}};
        {% endfor %}
        {% endif %}
        aggregated-ether-options {
            lacp {
                active;
                system-id {{systemId}};
            }
        }
    }
}

vlans {
    {% if networks and networks|length > 0 %}
    {% for network in networks %}{{network[2]}} {
        interface {{lagName}}.{{network[0]}};
    }
    {% endfor %}
    {% endif %}
    {% if deletedNetworks and deletedNetworks|length > 0 %}
    {% for deletedNetwork in deletedNetworks %}{{deletedNetwork[2]}} {
        delete:
        interface {{lagName}}.{{deletedNetwork[0]}};
    }
    {% endfor %}
    {% endif %}
}
